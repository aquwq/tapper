<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PIXEL ROGUE</title>

<style>
html,body{
  margin:0;
  background:#0b0e14;
  color:#e5e7eb;
  font-family:monospace;
  user-select:none;
}
#ui{
  padding:6px;
  text-align:center;
  font-size:14px;
}
#stats span{margin:0 6px}
canvas{
  display:block;
  margin:0 auto;
  background:#141925;
  image-rendering:pixelated;
  border-radius:12px;
}
button{
  background:#1f2937;
  color:#fff;
  border:1px solid #374151;
  border-radius:8px;
  padding:6px 10px;
  margin:4px;
}
#overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
}
.panel{
  background:#111827;
  padding:16px;
  border-radius:12px;
  width:90%;
  max-width:300px;
  text-align:center;
}
</style>
</head>
<body>

<div id="ui">
  <div id="stats">
    ‚ù§Ô∏è <span id="hp"></span>
    ‚öîÔ∏è <span id="atk"></span>
    ‚≠ê <span id="lvl"></span>
    üí∞ <span id="gold"></span>
    üåä <span id="wave"></span>
    ‚è± <span id="time"></span>s
  </div>
</div>

<canvas id="game" width="320" height="480"></canvas>

<div style="text-align:center">
  <button onclick="attack()">–ê–¢–ê–ö–ê</button>
  <button onclick="shop()">–ú–ê–ì–ê–ó–ò–ù</button>
  <button onclick="heal()">–•–ò–õ–ö–ê</button>
</div>

<div id="overlay">
  <div class="panel" id="panel"></div>
</div>

<script>
const c = document.getElementById("game");
const ctx = c.getContext("2d");

let startTime = Date.now();
let locked = false;

let player = {
  x:160,y:240,
  hp:30,maxHp:30,
  atk:4,
  lvl:1,xp:0,
  gold:0
};

let potions = 2;
let wave = 1;
let monsters = [];

function spawnWave(){
  monsters=[];
  for(let i=0;i<wave+1;i++){
    monsters.push({
      x:Math.random()*280+20,
      y:Math.random()*440+20,
      hp:8+wave*3,
      maxHp:8+wave*3
    });
  }
}
spawnWave();

function drawPixel(x,y,color){
  ctx.fillStyle=color;
  ctx.fillRect(x,y,8,8);
}

function drawPlayer(){
  drawPixel(player.x,player.y,"#fde68a"); // head
  drawPixel(player.x,player.y+8,"#3b82f6"); // body
  drawPixel(player.x-8,player.y+8,"#1e40af");
  drawPixel(player.x+8,player.y+8,"#1e40af");
}

function drawMonster(m){
  drawPixel(m.x,m.y,"#ef4444");
  drawPixel(m.x-8,m.y,"#991b1b");
  ctx.fillStyle="#22c55e";
  ctx.fillRect(m.x-12,m.y-10,(m.hp/m.maxHp)*24,3);
}

function update(){
  ctx.clearRect(0,0,c.width,c.height);

  drawPlayer();
  monsters.forEach(drawMonster);

  document.getElementById("hp").textContent = player.hp+"/"+player.maxHp;
  document.getElementById("atk").textContent = player.atk;
  document.getElementById("lvl").textContent = player.lvl;
  document.getElementById("gold").textContent = player.gold;
  document.getElementById("wave").textContent = wave;
  document.getElementById("time").textContent =
    Math.floor((Date.now()-startTime)/1000);

  if(!locked && Date.now()-startTime > 300000){
    locked = true;
    show("üîí –ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª—ã –∏ –Ω–∞–ø–∏—à–∏ –±–æ—Ç—É /continue");
  }

  requestAnimationFrame(update);
}
update();

function attack(){
  monsters.forEach((m,i)=>{
    if(Math.abs(player.x-m.x)<24 && Math.abs(player.y-m.y)<24){
      m.hp -= player.atk;
      if(m.hp<=0){
        monsters.splice(i,1);
        player.gold+=5;
        player.xp++;
        if(player.xp>=player.lvl*3){
          player.lvl++;
          player.atk++;
          player.maxHp+=5;
          player.hp=player.maxHp;
        }
      }
    }
  });
  if(monsters.length===0){
    wave++;
    spawnWave();
  }
}

function heal(){
  if(potions>0){
    potions--;
    player.hp=Math.min(player.maxHp,player.hp+15);
  }
}

function shop(){
  show(`
    <h3>–ú–ê–ì–ê–ó–ò–ù</h3>
    üß™ –•–∏–ª–∫–∞ (+1) ‚Äî 10üí∞<br>
    <button onclick="buyPotion()">–ö—É–ø–∏—Ç—å</button><br><br>
    ‚öîÔ∏è –£—Ä–æ–Ω +1 ‚Äî 20üí∞<br>
    <button onclick="buyAtk()">–ö—É–ø–∏—Ç—å</button><br><br>
    <button onclick="close()">–ó–∞–∫—Ä—ã—Ç—å</button>
  `);
}

function buyPotion(){
  if(player.gold>=10){player.gold-=10;potions++;}
}
function buyAtk(){
  if(player.gold>=20){player.gold-=20;player.atk++;}
}

function show(t){
  overlay.style.display="flex";
  panel.innerHTML=t;
}
function close(){
  overlay.style.display="none";
}

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft")player.x-=8;
  if(e.key==="ArrowRight")player.x+=8;
  if(e.key==="ArrowUp")player.y-=8;
  if(e.key==="ArrowDown")player.y+=8;
});
</script>
</body>
</html>
